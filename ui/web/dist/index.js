(()=>{var{defineProperty:i,getOwnPropertyNames:m,getOwnPropertyDescriptor:u}=Object,f=Object.prototype.hasOwnProperty;var n=new WeakMap,w=(s)=>{var e=n.get(s),t;if(e)return e;if(e=i({},"__esModule",{value:!0}),s&&typeof s==="object"||typeof s==="function")m(s).map((o)=>!f.call(e,o)&&i(e,o,{get:()=>s[o],enumerable:!(t=u(s,o))||t.enumerable}));return n.set(s,e),e};var v={};class c{baseUrl="/api";async getSettings(){let s=await fetch(`${this.baseUrl}/settings`);if(!s.ok)throw new Error("Failed to load settings");return s.json()}async updateSettings(s){if(!(await fetch(`${this.baseUrl}/settings`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).ok)throw new Error("Failed to save settings")}async getProcesses(){let s=await fetch(`${this.baseUrl}/processes`);if(!s.ok)throw new Error("Failed to load processes");return s.json()}async startProcess(s){let e=await fetch(`${this.baseUrl}/processes/${s}/start`,{method:"POST"});if(!e.ok){let t=await e.text();throw new Error(`Failed to start process: ${t}`)}}async stopProcess(s){let e=await fetch(`${this.baseUrl}/processes/${s}/stop`,{method:"POST"});if(!e.ok){let t=await e.text();throw new Error(`Failed to stop process: ${t}`)}}async removeProcess(s){let e=await fetch(`${this.baseUrl}/processes/${s}`,{method:"DELETE"});if(!e.ok){let t=await e.text();throw new Error(`Failed to remove process: ${t}`)}}async getTemplates(){let s=await fetch(`${this.baseUrl}/templates`);if(!s.ok)throw new Error("Failed to load templates");return s.json()}async instantiateTemplate(s,e,t){let o=await fetch(`${this.baseUrl}/templates/${s}/instantiate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({process_id:e,values:t})});if(!o.ok){let a=await o.text();throw new Error(`Failed to instantiate template: ${a}`)}}async createProcess(s){let e=await fetch(`${this.baseUrl}/processes`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!e.ok){let t=await e.text();throw new Error(`Failed to create process: ${t}`)}return e.json()}}var r=new c;var d=()=>({mode:"dark",autoRefresh:!0,refreshInterval:5000,async loadSettings(){try{let s=await r.getSettings();this.mode=s.color_mode,this.autoRefresh=s.auto_refresh,this.refreshInterval=s.refresh_interval,this.updateTheme()}catch(s){console.error("Failed to load settings:",s)}},async toggleMode(){this.mode=this.mode==="dark"?"light":"dark",this.updateTheme(),await this.saveSettings()},async saveSettings(){try{await r.updateSettings({color_mode:this.mode,auto_refresh:this.autoRefresh,refresh_interval:this.refreshInterval})}catch(s){console.error("Failed to save settings:",s)}},updateTheme(){if(this.mode==="dark")document.documentElement.classList.add("dark");else document.documentElement.classList.remove("dark")}});var h=()=>({processes:[],processesLoading:!1,processesError:null,autoRefreshInterval:null,async loadProcesses(){this.processesLoading=!0,this.processesError=null;try{this.processes=await r.getProcesses()}catch(s){this.processesError=s instanceof Error?s.message:"Failed to load processes",console.error("Failed to load processes:",s)}finally{this.processesLoading=!1}},async startProcess(s){try{await r.startProcess(s),await this.loadProcesses()}catch(e){this.processesError=e instanceof Error?e.message:"Failed to start process",console.error("Failed to start process:",e)}},async stopProcess(s){try{await r.stopProcess(s),await this.loadProcesses()}catch(e){this.processesError=e instanceof Error?e.message:"Failed to stop process",console.error("Failed to stop process:",e)}},async removeProcess(s){if(!confirm(`Are you sure you want to remove process ${s}?`))return;try{await r.removeProcess(s),await this.loadProcesses()}catch(e){this.processesError=e instanceof Error?e.message:"Failed to remove process",console.error("Failed to remove process:",e)}},getStatusClass(s){if(s==="NotStarted")return"status-notstarted";else if(s?.Running)return"status-running";else if(s?.Stopped)return"status-stopped";else if(s?.Failed)return"status-failed";return"status-notstarted"},startAutoRefresh(s){if(this.autoRefreshInterval)return;this.autoRefreshInterval=setInterval(()=>{this.loadProcesses()},s)},stopAutoRefresh(){if(this.autoRefreshInterval)clearInterval(this.autoRefreshInterval),this.autoRefreshInterval=null}});var l=(s)=>({processTemplates:[],processTemplatesLoading:!1,processTemplatesError:null,selectedProcessTemplate:null,showProcessTemplateModal:!1,processTemplateId:"",processTemplateVariableValues:{},async loadProcessTemplates(){this.processTemplatesLoading=!0,this.processTemplatesError=null;try{this.processTemplates=await r.getTemplates()}catch(e){this.processTemplatesError=e instanceof Error?e.message:"Failed to load templates",console.error("Failed to load process templates:",e)}finally{this.processTemplatesLoading=!1}},selectProcessTemplate(e){this.selectedProcessTemplate=e,this.showProcessTemplateModal=!0,this.processTemplateId=`${e.template_id}-${Date.now()}`,this.processTemplateVariableValues={},e.variables?.forEach((t)=>{if(t.default_value!==void 0)this.processTemplateVariableValues[t.name]=t.default_value})},closeProcessTemplateModal(){this.showProcessTemplateModal=!1,this.selectedProcessTemplate=null,this.processTemplateId="",this.processTemplateVariableValues={}},async instantiateProcessTemplate(){if(!this.selectedProcessTemplate)return;try{await r.instantiateTemplate(this.selectedProcessTemplate.template_id,this.processTemplateId,this.processTemplateVariableValues),await s(),this.closeProcessTemplateModal()}catch(e){this.processTemplatesError=e instanceof Error?e.message:"Failed to instantiate template",console.error("Failed to instantiate process template:",e)}}});var p=(s)=>({addingTestProcess:!1,async addTestProcesses(){this.addingTestProcess=!0;let e=[{id:`echo-test-${Date.now()}`,command:"echo",args:["Hello from Ichimi Server!"],env:{},cwd:null},{id:`sleep-test-${Date.now()}`,command:"sleep",args:["300"],env:{},cwd:null},{id:`date-loop-${Date.now()}`,command:"sh",args:["-c",'while true; do date; echo "---"; sleep 5; done'],env:{},cwd:null},{id:`python-server-${Date.now()}`,command:"python3",args:["-m","http.server","0"],env:{},cwd:"/tmp"},{id:`counter-${Date.now()}`,command:"sh",args:["-c",'for i in $(seq 1 100); do echo "Count: $i"; sleep 1; done'],env:{},cwd:null}];try{for(let t of e)await r.createProcess(t);await s(),console.log("Test processes added successfully")}catch(t){console.error("Failed to add test processes:",t)}finally{this.addingTestProcess=!1}}});var g=()=>{let s=d(),e=h(),t=l(async()=>{await e.loadProcesses()}),o=p(async()=>{await e.loadProcesses()}),a={...s,...e,...t,...o,initialized:!1,async init(){if(this.initialized){console.warn("State store init() called multiple times - skipping");return}if(this.initialized=!0,console.log("State init"),await Promise.all([this.loadSettings(),this.loadProcesses(),this.loadProcessTemplates()]),this.autoRefresh)this.startAutoRefresh(this.refreshInterval)}};return Object.setPrototypeOf(a,{...Object.getPrototypeOf(s),...Object.getPrototypeOf(e),...Object.getPrototypeOf(t),...Object.getPrototypeOf(o)}),a};console.log("Ichimi UI loaded");document.addEventListener("alpine:init",()=>{console.log("Alpine.js is initializing...");let s=g();window.Alpine.store("state",s)});console.log("Event listener registered");})();
